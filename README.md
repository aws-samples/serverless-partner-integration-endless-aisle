# serveless-partner-integration-endless-aisle

This CDK constructs provides sample serverless solution for multiple partner integration. 

This AWS CDK application that provides a sample to create `Endless Aisle` solution for an e-commerce company. `Endless Aisle` is an alternative solution to meet customer’s demand. It models as drop-shipping i.e. fulfilling the order through automated integration with the product or reseller partners. Such automation would result in customer’s ability to place the order on a tablet or kiosk when they do not find a specific product of their choice. It allows businesses to no longer keep stock products more than the shelf inventory and still the end customer can place an order and get it shipped at their home.

The `cdk.json` file tells the CDK Toolkit how to execute your app.


# Build Endless Aisle serverless architecture using AWS CloudFront, AWS S3, Amazon API Gateway, Amazon SQS and AWS Lambda	
<!--BEGIN STABILITY BANNER-->
---

![Stability: Experimental](https://img.shields.io/badge/stability-Experimental-important.svg?style=for-the-badge)

> **This is an experimental example. It may not build out of the box**
>
> This example is built using Construct Libraries marked "Experimental" and may not be updated for latest breaking changes.
>
> If build is unsuccessful, please create an [issue](TBA) so that we may debug the problem 

---
<!--END STABILITY BANNER-->
| **Language**     |
|:-------------|
|![Typescript Logo](https://docs.aws.amazon.com/cdk/api/latest/img/typescript32.png) Typescript|


## Build
To install and build the latest code in `serveless-partner-integration-endless-aisle` and `lambda` folders:

```bash
npm install -g aws-cdk

cd serveless-partner-integration-endless-aisle
npm install

cd lambda
npm install
cd ..
npm run build
```

This will install the AWS CDK client, install/build the sample application under `serveless-partner-integration-endless-aisle` and then install/build the lambda functions  under `lambda` folder.

## Synthesize Cloudformation Template

To see the Cloudformation template generated by the CDK, run `cdk synth` in the project folder, then check the output file in the "cdk.out" directory.

## Deploy

Run `cdk deploy`. This will deploy / redeploy your Stack to your AWS Account.

```bash
cdk deploy
```

After the deployment CDK will output the API Gateway URL endpoint to be used for testing.

## Architecture

![Architecture Diagram](architecture.png)


## Default settings

Out of the box implementation of the Construct without any override will set the following defaults:

#### Amazon API Gateway
- Deploy an edge-optimized API endpoint
- Enable CloudWatch logging for API Gateway
- Configure least privilege access IAM role for API Gateway
- Set the default authorizationType for all API methods to IAM
- Enable X-Ray Tracing

#### Amazon DynamoDB Table
- Set the billing mode for DynamoDB Table to On-Demand (Pay per request)
- Enable server-side encryption for DynamoDB Table using AWS managed KMS Key
- Creates a partition key called 'id' for DynamoDB Table
- Retain the Table when deleting the CloudFormation stack
- Enable continuous backups and point-in-time recovery

#### Amazon S3 Bucket
- Configure Access logging for Amazon S3 Bucket
- Enable server-side encryption for Amazon S3 Bucket using AWS managed KMS Key
- Enforce encryption of data in transit
- Turn on the versioning for Amazon S3 Bucket
- Don't allow public access for Amazon S3 Bucket
- Retain the Amazon S3 Bucket when deleting the CloudFormation stack
- Applies Lifecycle rule to move non-current object versions to Glacier storage after 90 days

#### AWS Lambda Function
- Configure limited privilege access IAM role for AWS Lambda function
- Enable X-Ray Tracing
- Set Environment Variables
- AWS_NODEJS_CONNECTION_REUSE_ENABLED (for Node 18.x and higher functions)

### Amazon CloudFront
- Configure Access logging for CloudFront Distribution
- Enable automatic injection of best practice HTTP security headers in all responses from CloudFront Distribution
- CloudFront originPath set to `'/'`

### Amazon SQS Queue
- Deploy SQS dead-letter queue for the source SQS Queue
- Enable server-side encryption for source SQS Queue using AWS Managed KMS Key
- Enforce encryption of data in transit


## Useful commands

* `npm run build`   compile typescript to js
* `npm run watch`   watch for changes and compile
* `npm run test`    perform the jest unit tests
* `cdk deploy`      deploy this stack to your default AWS account/region
* `cdk diff`        compare deployed stack with current state
* `cdk synth`       emits the synthesized CloudFormation template

## Security

See [CONTRIBUTING](CONTRIBUTING.md#security-issue-notifications) for more information.

## License

This library is licensed under the MIT-0 License. See the LICENSE file.

